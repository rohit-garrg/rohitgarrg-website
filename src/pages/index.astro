---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleCard from '../components/ArticleCard.astro';

// Get articles from content collection, sorted by date (newest first), limit to 3
const allArticles = await getCollection('writing');

const latestArticles = allArticles
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3)
  .map(article => {
    const slug = article.id.replace(/\.md$/, '');
    return {
      title: article.data.title,
      description: article.data.description,
      category: article.data.category,
      date: article.data.date,
      slug,
      leadImage: article.data.leadImage
    };
  });

// WebSite schema for homepage
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Rohit Garg",
  "description": "Head of Product & Design at Times of India. Writing about product management, leadership, and AI tools.",
  "url": "https://www.rohitgarrg.com",
  "author": {
    "@type": "Person",
    "name": "Rohit Garg",
    "jobTitle": "Head of Product & Design",
    "worksFor": {
      "@type": "Organization",
      "name": "Times of India"
    }
  }
};
---

<BaseLayout>
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
  <div class="container">
    <!-- Hero Section -->
    <section class="hero">
      <h1>Rohit Garg</h1>
      <p class="tagline">Product at scale. Built with AI.</p>
      <p class="subtitle">Head of Product & Design at Times of India</p>
      <div class="social-links">
        <a href="https://www.linkedin.com/in/rohitgarrg/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
        <a href="mailto:rohitgarrg@gmail.com">Email</a>
      </div>
    </section>

    <!-- Latest Writing Section -->
    <section class="section">
      <div class="section-header">
        <h2>Latest Writing</h2>
        <a href="/writing" class="view-all">View all →</a>
      </div>
      <div class="articles-grid">
        {latestArticles.length > 0 ? (
          latestArticles.map((article) => (
            <ArticleCard
              title={article.title}
              description={article.description}
              category={article.category}
              date={article.date}
              slug={article.slug}
              leadImage={article.leadImage}
            />
          ))
        ) : (
          <p class="empty-state">Articles coming soon.</p>
        )}
      </div>
    </section>

    <!-- Projects Section -->
    <section class="section section-projects">
      <div class="section-header">
        <h2>Projects</h2>
        <a href="/projects" class="view-all">View all →</a>
      </div>
      <div class="projects-grid">
        <a href="/projects/office-survivors" class="project-card">
          <img src="/images/projects/office-survivors-og.webp" alt="Office Survivors game screenshot" class="project-thumb" loading="lazy" />
          <div class="project-card-body">
            <h3>Office Survivors</h3>
            <p>A satirical pixel-art browser game about surviving corporate life. Deliver tasks, dodge chaos agents, and climb from intern to CEO.</p>
            <div class="project-meta">
              <span class="project-tag">Phaser 3</span>
              <span class="project-tag">Built with AI</span>
            </div>
          </div>
        </a>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .hero {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    padding: var(--space-lg) 0 var(--space-xl) 0;
  }

  h1 {
    font-size: 3.5rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-sm);
  }

  .tagline {
    font-size: 1.5rem;
    font-weight: 500;
    background: linear-gradient(135deg, var(--color-accent) 0%, #7c3aed 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: var(--space-xs);
  }

  .subtitle {
    font-size: 1.125rem;
    color: var(--color-text-light);
    margin-bottom: var(--space-md);
  }

  .social-links {
    display: flex;
    gap: var(--space-md);
  }

  .social-links a {
    font-size: 0.9375rem;
    font-weight: 500;
  }

  .section {
    padding: var(--space-xl) 0;
    border-top: 1px solid var(--color-border);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
    gap: var(--space-md);
  }

  .section-header h2 {
    margin-bottom: 0;
  }

  .view-all {
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
    padding: var(--space-xs) var(--space-sm);
    border-radius: 6px;
    transition: background-color 0.2s ease;
  }

  .view-all:hover {
    background-color: rgba(37, 99, 235, 0.08);
  }

  .articles-grid {
    display: grid;
    gap: var(--space-md);
  }

  .projects-grid {
    display: grid;
    gap: var(--space-md);
  }

  .section-projects {
    padding-bottom: var(--space-lg);
  }

  .project-card {
    display: block;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    transition: border-color 0.2s;
  }

  .project-card:hover {
    border-color: var(--color-text);
  }

  .project-thumb {
    width: 100%;
    height: auto;
    display: block;
  }

  .project-card-body {
    padding: var(--space-md) var(--space-lg);
  }

  .project-card h3 {
    margin-bottom: var(--space-xs);
    color: var(--color-text);
    font-size: 1.125rem;
  }

  .project-card p {
    margin-bottom: var(--space-sm);
    font-size: 0.9375rem;
    color: var(--color-text-light);
    line-height: 1.6;
  }

  .project-meta {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
  }

  .project-tag {
    font-size: 0.8rem;
    padding: 0.2em 0.6em;
    background: var(--color-bg-alt, #f5f5f5);
    border-radius: 4px;
    color: var(--color-text-light);
  }

  @media (max-width: 768px) {
    .hero {
      padding: var(--space-md) 0 var(--space-lg) 0;
    }

    h1 {
      font-size: 2.5rem;
      letter-spacing: -0.01em;
    }

    .tagline {
      font-size: 1.25rem;
    }

    .subtitle {
      font-size: 1rem;
    }

    .section-header {
      flex-direction: column;
      gap: var(--space-xs);
    }
  }
</style>
